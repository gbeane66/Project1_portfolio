{
  "hash": "4fd59619d2a33002478aec9f0c324f88",
  "result": {
    "markdown": "---\ntitle: \"Portfolio Project 1: Predicting water potability\"\nexecute: \n  echo: true\n\nformat:\n  html:\n    page-layout: full\n    theme:\n      light: cosmo\n      dark: [cosmo, theme_dark_custom.scss]\n    code-link: true\n    code-fold: true\n---\n\n## Goal\nThe purpose of this project is to use machine learning to determine whether water is safe for human consumption based on a range of different metrics.\n\n## ðŸ’§ Step 1.0 | EDA\n\nTo begin with let's load the data as a polars DataFrame. Why use the Polars package and not the Pandas package? Speed. The Polars package is much faster than Pandas and, while this is not really a factor in this project owing to the small size of the dataset, it might be useful to familiarise myself with any differences in polars now. In any case,\n\n### Step 1.1 | Import libraries\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\n# Import packages for data manipulation\nimport polars as pl\nimport numpy as np\n\n# Import packages for data visualization\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.metrics import ConfusionMatrixDisplay, confusion_matrix\n\n# Import packages for data preprocessing\nfrom sklearn.model_selection import GridSearchCV, train_test_split, PredefinedSplit\n\n\n# Import packages for data modeling\nfrom sklearn.metrics import accuracy_score, precision_score, recall_score,f1_score\n\n# Import three methods for ML\nfrom sklearn.tree import DecisionTreeClassifier\n\nfrom sklearn.ensemble import RandomForestClassifier\n\nfrom xgboost import XGBClassifier\nfrom xgboost import plot_importance\n```\n:::\n\n\n### Step 1.2 | Load Data\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\ndata = pl.read_csv('water_potability.csv')\n```\n:::\n\n\n### Step 1.3 | View Data\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\ndata.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=80}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (5, 10)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>ph</th><th>Hardness</th><th>Solids</th><th>Chloramines</th><th>Sulfate</th><th>Conductivity</th><th>Organic_carbon</th><th>Trihalomethanes</th><th>Turbidity</th><th>Potability</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>i64</td></tr></thead><tbody><tr><td>null</td><td>204.890455</td><td>20791.318981</td><td>7.300212</td><td>368.516441</td><td>564.308654</td><td>10.379783</td><td>86.99097</td><td>2.963135</td><td>0</td></tr><tr><td>3.71608</td><td>129.422921</td><td>18630.057858</td><td>6.635246</td><td>null</td><td>592.885359</td><td>15.180013</td><td>56.329076</td><td>4.500656</td><td>0</td></tr><tr><td>8.099124</td><td>224.236259</td><td>19909.541732</td><td>9.275884</td><td>null</td><td>418.606213</td><td>16.868637</td><td>66.420093</td><td>3.055934</td><td>0</td></tr><tr><td>8.316766</td><td>214.373394</td><td>22018.417441</td><td>8.059332</td><td>356.886136</td><td>363.266516</td><td>18.436524</td><td>100.341674</td><td>4.628771</td><td>0</td></tr><tr><td>9.092223</td><td>181.101509</td><td>17978.986339</td><td>6.5466</td><td>310.135738</td><td>398.410813</td><td>11.558279</td><td>31.997993</td><td>4.075075</td><td>0</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nOK, so there are 10 fields in the DataFrame (`pH`,`Hardness`,`Solids`, `Chloramines`,`Sulfate`,`Conductivity`,`Organic Carbon`,`Trihalomethanes`,`Turbidity` and `Potability`). Of these, `Potability` is the target variable (the one we are trying to predict) and it is *binary* - it can either be **potable** (1) or **not-potable** (0). The other 9 fields are all float values. \n\nLet's now have an overview of the fields in terms of `nulls` and various other statistics.\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\ndata.describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=81}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (9, 11)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>statistic</th><th>ph</th><th>Hardness</th><th>Solids</th><th>Chloramines</th><th>Sulfate</th><th>Conductivity</th><th>Organic_carbon</th><th>Trihalomethanes</th><th>Turbidity</th><th>Potability</th></tr><tr><td>str</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;count&quot;</td><td>2785.0</td><td>3276.0</td><td>3276.0</td><td>3276.0</td><td>2495.0</td><td>3276.0</td><td>3276.0</td><td>3114.0</td><td>3276.0</td><td>3276.0</td></tr><tr><td>&quot;null_count&quot;</td><td>491.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>781.0</td><td>0.0</td><td>0.0</td><td>162.0</td><td>0.0</td><td>0.0</td></tr><tr><td>&quot;mean&quot;</td><td>7.080795</td><td>196.369496</td><td>22014.092526</td><td>7.122277</td><td>333.775777</td><td>426.205111</td><td>14.28497</td><td>66.396293</td><td>3.966786</td><td>0.39011</td></tr><tr><td>&quot;std&quot;</td><td>1.59432</td><td>32.879761</td><td>8768.570828</td><td>1.583085</td><td>41.41684</td><td>80.824064</td><td>3.308162</td><td>16.175008</td><td>0.780382</td><td>0.487849</td></tr><tr><td>&quot;min&quot;</td><td>0.0</td><td>47.432</td><td>320.942611</td><td>0.352</td><td>129.0</td><td>181.483754</td><td>2.2</td><td>0.738</td><td>1.45</td><td>0.0</td></tr><tr><td>&quot;25%&quot;</td><td>6.093092</td><td>176.853696</td><td>15668.273618</td><td>6.127804</td><td>307.704474</td><td>365.739122</td><td>12.065963</td><td>55.835966</td><td>3.43974</td><td>0.0</td></tr><tr><td>&quot;50%&quot;</td><td>7.036752</td><td>196.982379</td><td>20933.51275</td><td>7.130437</td><td>333.073546</td><td>421.890083</td><td>14.219303</td><td>66.623944</td><td>3.955091</td><td>0.0</td></tr><tr><td>&quot;75%&quot;</td><td>8.062066</td><td>216.665319</td><td>27331.361962</td><td>8.114731</td><td>359.951766</td><td>481.771934</td><td>16.557177</td><td>77.339918</td><td>4.500208</td><td>1.0</td></tr><tr><td>&quot;max&quot;</td><td>14.0</td><td>323.124</td><td>61227.196008</td><td>13.127</td><td>481.030642</td><td>753.34262</td><td>28.3</td><td>124.0</td><td>6.739</td><td>1.0</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nBased on the statistical overview of the fields, the things that jump out at me are:\n\n1) `pH`, `Sulfate` and `Trihalomethanes` all have significant numbers of `null` values. These will have to be either dropped or filled.\n2) Other fields look reasonable, though the range of pH (from 0.0 to 14.0) while physically valid is outrageous. This means some of the tested water sources were extremely acidic (pH 0.0) or extremely basic (pH 14.0).\n\nAre any of the fields obviously correlated with each other? We can do a quick check of this using a simple pairplot.\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nsns.pairplot(data.to_pandas(), hue='Potability', corner=True, palette='Greens')\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-6-output-1.png){}\n:::\n:::\n\n\nAnother way of showing the same thing\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\nfig, ax = plt.subplots(figsize=(8,6))\nsns.heatmap(data.to_pandas().corr(),annot=True,cmap='Greens',ax=ax)\nplt.title(\"Correlation Matrix\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-7-output-1.png){}\n:::\n:::\n\n\nThere does not seem to be any correlation between any of the fields - no obvious linear relationship is apparrent in the correlation plots.\n\n## Step 2.0 | Pre-process data \n\nNow that we know a little bit more about our data, let's deal with some problems that we identified in Step 1. Namely, what do we do about the null values?\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\nprint('Percentage(%) of nulls in each column: \\n')\n\nprint(data.to_pandas().isna().sum()/len(data)*100)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nPercentage(%) of nulls in each column: \n\nph                 14.987790\nHardness            0.000000\nSolids              0.000000\nChloramines         0.000000\nSulfate            23.840049\nConductivity        0.000000\nOrganic_carbon      0.000000\nTrihalomethanes     4.945055\nTurbidity           0.000000\nPotability          0.000000\ndtype: float64\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}